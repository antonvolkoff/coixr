<div class="container">
  <header>
    <div class="query">
      <div id="editor"><%= @query %></div>
    </div>
    <%= form_tag searches_path, method: :post, id: 'search-form', remote: true do %>
      <%= hidden_field_tag :query, params[:query] %>
      <%= hidden_field_tag :page, '0' %>
    <% end %>
  </header>
  <section class="results"></section>
</div>


<%= javascript_include_tag "//cdn.jsdelivr.net/ace/1.1.3/min/ace.js" %>
<%= javascript_include_tag "//cdn.jsdelivr.net/ace/1.1.3/min/ext-language_tools.js" %>
<script>
  var updateUrl = function() {
    var query = $('input#query').val();
    var page = $('input#page').val();
    var path = "?query=" + encodeURIComponent(query) + "&page=" + page;
    history.pushState({}, 'title', path);
  }

  ace.require("ace/ext/language_tools");

  var editor = ace.edit("editor");
  editor.setTheme("ace/theme/tomorrow_night");
  editor.getSession().setMode("ace/mode/sql");
  editor.renderer.setShowGutter(false);
  editor.setHighlightActiveLine(false);
  editor.setShowPrintMargin(false);
  editor.setOptions({
    enableBasicAutocompletion: true
  });

  document.getElementById('editor').style.fontSize='14px';

  editor.commands.bindKey("enter", function(editor) {
    $('input#query').val(editor.getValue());
    $('form#search-form').submit();
    updateUrl();
  }); 

  editor.commands.bindKey("up", function(editor) { /* do nothing */ });
  editor.commands.bindKey("down", function(editor) { /* do nothing */ });
</script>